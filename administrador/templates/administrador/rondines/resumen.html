{% extends 'administrador/bases/base_admin.html' %}

{% block 'seo_header' %}
    <title>Panoptic |  Expertos en seguridad privada industrial, comercial y personal</title>
    <meta http-equiv="Content-Langrondinese" content="es-MX">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
    <meta name="description" content="Monitoreo Inteligente en seguridad privada para empresas y unidades de negocio">
{% endblock %}

{% block css %}
    <!-- Starts to include CSS list -->
    {% for css in css_list %}
        {% include 'core/includes/css/'|add:css|add:'.htm' %}
    {% endfor %}
    <!-- Ends to include CSS list -->    
    {% load static %}
    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
          height: 100%;
        }        
    </style>    
    <link rel="stylesheet" href="{% static 'core/assets/css/mapsinfoscroll.css' %}">
{% endblock css %}-*

{% block 'content' %}
<div class="app-page-title">    
    <div class="page-title-wrapper">
        <div class="page-title-heading">
            <div class="mini-logo-panoptic">                
                <i class="fas fa-user-shield size128 soundblue" aria-hidden="true"></i>                                   
            </div>
            <div>Rondines &nbsp; <i class="fas fa-angle-double-right"></i> &nbsp; Dashboard
                <div class="admin-page-title-subheading">
                    Detalle de Información General
                </div>
            </div>
        </div> 
        <div class="container">
            <div class="row">
                <div class="col-lg-6">
                </div>
                <div class="col-lg-6">
                    <nav class="" aria-label="admin breadcrumb">
                        <ol class="admin breadcrumb pull-right">
                            <li class="breadcrumb-item">
                                <a>
                                    <i aria-hidden="true" class="fa fa-home"></i>
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a> Rondines</a>
                            </li>
                            <li class="breadcrumb-item">
                                <a> Dashboard</a>
                            </li>
                            <li class="active breadcrumb-item" aria-current="page">
                                Detalle de Información General
                            </li>
                        </ol>
                    </nav>              
                </div>
            </div>        
        </div>        
    </div>
</div>
<!-- Row de botones de acción  -->
<div class="row">
    <div class="col-md-6 col-lg-3">
        <div class="widget-chart widget-chart2 text-left mb-3 card-btm-border card-shadow-primary border-primary card">
            <div class="widget-chat-wrapper-outer">
                <div class="widget-chart-content">
                    <div class="widget-title text-uppercase">Crear Rondín</div>
                    <div class="widget-numbers mt-2 fsize-4 mb-0 w-100">
                        <div class="widget-chart-flex align-items-center">
                            <div>
                                <a class="bgp-color-rojo" href="{% url 'administrador:admin_rondines_rondin_create' %}">                                              
                                    <i class="fas fa-plus-circle bgp-color-rojo" aria-hidden="true"></i>
                                    &nbsp;Agregar Rondín                                          
                                </a>
                            </div>
                            <div class="widget-title ml-auto font-size-lg font-weight-normal text-muted">
                                <div class="d-inline-block"><canvas width="46" height="46"></canvas>
                                    <small><span title="Agregue rondines a una unidad de negocio en específico"><i class="fas fa-question-circle bgp-color-azul size16"></i></span></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-lg-3">
        <div class="widget-chart widget-chart2 text-left mb-3 card-btm-border card-shadow-danger border-primary card">
            <div class="widget-chat-wrapper-outer">
                <div class="widget-chart-content">
                    <div class="widget-title text-uppercase">Impresión de QR's</div>
                    <div class="widget-numbers mt-2 fsize-4 mb-0 w-100">
                        <div class="widget-chart-flex align-items-center">
                            <div>
                                <a class="bgp-color-rojo" href="/backstage/rondines/mapa-interactivo">                                              
                                    <i class="fas fa-edit bgp-color-rojo" aria-hidden="true"></i>
                                    &nbsp;Editar Rondín                                          
                                </a>
                            </div>
                            <div class="widget-title ml-auto font-size-lg font-weight-normal text-muted">
                                <div class="d-inline-block"><canvas width="46" height="46"></canvas>
                                    <small><span title="Agregue rondines a una unidad de negocio en específico"><i class="fas fa-question-circle bgp-color-azul size16"></i></span></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-lg-3">
        <div class="widget-chart widget-chart2 text-left mb-3 card-btm-border card-shadow-warning border-primary card">
            <div class="widget-chat-wrapper-outer">
                <div class="widget-chart-content">
                    <div class="widget-title text-uppercase">Editar Rondín</div>
                    <div class="widget-numbers mt-2 fsize-4 mb-0 w-100">
                        <div class="widget-chart-flex align-items-center">
                            <div>                                
                                <a class="bgp-color-rojo" href="{% url 'administrador:admin_rondines_rondin_create' %}">                                              
                                    <i class="fas fa-qrcode bgp-color-rojo" aria-hidden="true"></i>
                                    &nbsp;Impresión QR's                                            
                                </a>
                            </div>
                            <div class="widget-title ml-auto font-size-lg font-weight-normal text-muted">
                                <div class="d-inline-block"><canvas width="46" height="46"></canvas>
                                    <small><span title="Agregue rondines a una unidad de negocio en específico"><i class="fas fa-question-circle bgp-color-azul size16"></i></span></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-lg-3">
        <div class="widget-chart widget-chart2 text-left mb-3 card-btm-border card-shadow-success border-success card">
            <div class="widget-chat-wrapper-outer">
                <div class="widget-chart-content">
                    <div class="widget-title opacity-5 text-uppercase">Por mostrar</div>
                    <div class="widget-numbers mt-2 fsize-4 mb-0 w-100">
                        <div class="widget-chart-flex align-items-center">
                            <div>
                                <a class="bgp-color-rojo" href="{% url 'administrador:admin_rondines_rondin_create' %}">                                              
                                    <i class="fa fa-wpforms bgp-color-rojo" aria-hidden="true"></i>
                                    &nbsp;Reportes                                         
                                </a>
                            </div>
                            <div class="widget-title ml-auto font-size-lg font-weight-normal text-muted">
                                <div class="d-inline-block"><canvas width="46" height="46"></canvas>
                                    <small><span title="Agregue rondines a una unidad de negocio en específico"><i class="fas fa-question-circle bgp-color-azul size16"></i></span></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Row de Tareas -->
<div class="row" >
    <!-- Columna Izquierda -->    
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="mb-3 card">
            <div class="card-header-tab card-header-tab-animation card-header">
                <div class="card-header-title">                                          
                    <i class="cardhead fas fa-tasks bgp-color-light-brown" aria-hidden="true"></i>
                    ÚLTIMOS PUNTOS  DE RONDINES 
                </div>                                                        
            </div>
            <div class="card-body">  
                <table class="mb-0 table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Punto</th>
                            <th>Hora de Inicio</th>
                            <th>Hora Fin</th>
                            <th>Rondín Term.</th>
                            <th align="center" class="text-center">Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for punto_hecho in punto_hechos %}
                        <tr data-user-id="{{ punto_hecho.id }}">
                            <th scope="row">{{ forloop.counter }}</th>
                            <td>{{ punto_hecho.punto.nombre }}</td>
                            <td>{{ punto_hecho.hora_inicio }}</td>
                            <td>{{ punto_hecho.hora_fin|default_if_none:"En progreso" }}</td>
                            <td>{{ punto_hecho.rondinhecho.rondin.nombre }}</td>
                            <td align="center">                                    
                                <a href="{% url 'administrador:admin_rondines_show' rondin_id=punto_hecho.rondinhecho.rondin.id %}" class="mb-2 mr-2 btn-pill btn-hover-shine btn btn-light labelCargo">Ver Rondín</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>   
            </div>  
            <div class="d-block text-right card-footer">                
                <button class="btn-wide btn btn-primary mayus">Vér Puntos de Rondines</button>
            </div>
        </div>
    </div> <!-- Fin de Columan Izquierda-->
    
    <!-- Columna Derecha -->
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="mb-3 card">
            <div class="card-header-tab card-header-tab-animation card-header">
                <div class="card-header-title">                                            
                    <i class="cardhead fas fa-chart-bar bgp-color-light-brown" aria-hidden="true"></i>
                    ESTADISTICO DE RONDINES: 
                </div>                                                        
            </div>
            <div class="card-body">  
                <div id="graf_rondines_general"></div> 
            </div>  
        </div>
    </div> <!-- Fin de Columan Derecha-->
</div> 

<!-- Row de Rondines -->
<div class="row" >        
    <!-- Columna Izquierda -->
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="mb-3 card">
            <div class="card-header-tab card-header-tab-animation card-header">
                <div class="card-header-title">                                            
                    <i class="cardhead fas fa-user-shield" aria-hidden="true"></i>
                    ÚLTIMOS RONDINES 
                </div>                                                        
            </div>
            <div class="card-body">  
                <table class="mb-0 table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nombre</th>
                            <th>Cliente</th>
                            <th>Planta</th>
                            <th>Tiempo Estimado</th>
                            <th align="center" class="text-center">Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u_rondin in ultimos_rondines %}
                        <tr data-user-id="{{ rondines.id }}">
                            <th scope="row">{{ forloop.counter }}</th>
                            <td>{{ u_rondin.nombre }}</td>
                            <td>{{ u_rondin.cliente }}</td>
                            <td>{{ u_rondin.planta }}</td>
                            <td>{{ u_rondin.tiempo_estimado }} mins.</td>
                            <td align="center">                                    
                                <button class="mb-2 mr-2 btn-pill btn-hover-shine btn btn-light labelCargo">Ver Rondín</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table> 
            </div>  
        </div>
    </div> <!-- Fin de Columan Izquierda-->

    <!-- Columna Derecha -->
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="mb-3 card">
            <div class="card-header-tab card-header-tab-animation card-header">
                <div class="card-header-title">                                            
                    <i class="cardhead fas fa-user-shield" aria-hidden="true"></i>
                    RONDINES EN PROGRESO
                </div>                                                        
            </div>
            <div class="card-body">  
                <table class="mb-0 table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nombre</th>
                            <th>Cliente</th>
                            <th>Planta</th>
                            <th>Tiempo Estimado</th>
                            <th align="center" class="text-center">Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u_rondin in ultimos_rondines %}
                        <tr data-user-id="{{ rondines.id }}">
                            <th scope="row">{{ forloop.counter }}</th>
                            <td>{{ u_rondin.nombre }}</td>
                            <td>{{ u_rondin.cliente }}</td>
                            <td>{{ u_rondin.planta }}</td>
                            <td>{{ u_rondin.tiempo_estimado }} mins.</td>
                            <td align="center">                                    
                                <button class="mb-2 mr-2 btn-pill btn-hover-shine btn btn-light labelCargo">Ver Rondín</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>  
            </div>  
        </div>
    </div> <!-- Fin de Columan Derecha-->
</div> 

<!-- Row de Puntos -->
<div class="row" >        
    <!-- Columna Izquierda -->    
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="mb-3 card">
            <div class="card-header-tab card-header-tab-animation card-header">
                <div class="card-header-title">                                            
                    <i class="cardhead fas fa-qrcode bgp-color-light-green" aria-hidden="true"></i>
                    PUNTOS DE RONDINES
                </div>                                                        
            </div>
            <div class="card-body">  
                <table class="mb-0 table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nombre</th>
                            <th>Tarea</th>
                            <th>Rondín</th>
                            <th>Orden</th>
                            <th align="center" class="text-center">Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for punto in puntos %}
                        <tr data-user-id="{{ rondines.id }}">
                            <th scope="row">{{ forloop.counter }}</th>
                            <td>{{ punto.nombre }}</td>
                            <td><span class="truncate-tel"> {{ punto.tareas | upper }} </span></td>
                            <td>{{ punto.rondin.nombre }}</td>
                            <td align="center">{{ punto.orden }}</td>
                            <td align="center">                                    
                                <button class="mb-2 mr-2 btn-pill btn-hover-shine btn btn-light labelCargo">Ver Rondín</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>  
            </div>  
        </div>
    </div> <!-- Fin de Columan Izquierda-->

    <!-- Columna Derecha -->
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
        <div class="mb-3 card">
            <div class="card-header-tab card-header-tab-animation card-header">
                <div class="card-header-title">                                            
                    <i class="cardhead fas fa-qrcode bgp-color-light-green" aria-hidden="true"></i>
                    PUNTOS DEL RONDIN: <b>Garita</b>
                </div>                                                        
            </div>
            <div class="card-body">  
                <table class="mb-0 table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nombre</th>
                            <th>Tarea</th>
                            <th>Rondín</th>
                            <th>Orden</th>
                            <th align="center" class="text-center">Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for punto in puntos %}
                        <tr data-user-id="{{ rondines.id }}">
                            <th scope="row">{{ forloop.counter }}</th>
                            <td>{{ punto.nombre }}</td>
                            <td><span class="truncate-tel"> {{ punto.tareas | upper }} </span></td>
                            <td>{{ punto.rondin.nombre }}</td>
                            <td align="center">{{ punto.orden }}</td>
                            <td align="center">                                    
                                <button class="mb-2 mr-2 btn-pill btn-hover-shine btn btn-light labelCargo">Ver Rondín</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>   
            </div>  
        </div>
    </div> <!-- Fin de Columan Derecha-->
</div> 

<div class="row" >        
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
        <div class="mb-3 card">
            <div class="card-header-tab card-header-tab-animation card-header">
                <div class="card-header-title">                                            
                    <i class="cardhead fas fa-list-alt" aria-hidden="true"></i>
                    RONDINES 
                </div>                                                        
            </div>
            <div class="card-body">     
                {% if  messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}" role="alert">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}       
                <!--  Data Table Start -->
                <table id="tblusuarios" class="table table-striped table-bordered dt-responsive nowrap">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Guardía</th>
                            <th>Clientes Asociado</th>
                            <th>Unidad de Negocio</th>
                            <th>Tiempo estimado</th>                              
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for rondin in rondines %}
                        <tr>                                    
                            <td>{{ rondin.nombre }}</td>
                            <td>{{ rondin.nombre }}</td>
                            <td>{{ rondin.cliente }}</td>
                            <td>{{ rondin.planta }}</td>
                            <td>{{ rondin.tiempo_estimado }}</td>                                                            
                            <td> 
                                <a href="{% url 'administrador:admin_perfiles_global_show' user_id=rondin.id %}" title="Ver registro" class="btnsInDataTable btn-transition border-0 btn btn-outline-primary text-center"><i class="fas fa-eye size16"></i></a>
                                <a href="{% url 'administrador:admin_perfiles_global_edit' user_id=rondin.id %}" title="Editar registro" class="btnsInDataTable btn-transition border-0 btn btn-outline-secondary text-center"><i class="fas fa-edit size16"></i></a>
                                <a href="#" title="Borrar registro" class="btnsInDataTable btn-transition border-0 btn btn-outline-danger text-center" onclick="return confirm('¿Est&aacute; seguro de borrar al usuario?')"><i class="fas fa-trash-alt size16  bgp-color-rojo"></i></a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>                          
                    <tfoot>
                        <tr>   
                            <th>Usuario</th>
                            <th>Guardía</th>
                            <th>Clientes Asociado</th>
                            <th>Unidad de Negocio</th>
                            <th>Fecha de Alta</th>                             
                            <th>Acción</th>
                        </tr>
                    </tfoot>
                </table>        
                <!-- Data Table End -->
            </div>  
        </div>
    </div> 
</div> 

</div>                    
{% endblock %}

{% block js %}
<!-- Starts to include JS list -->
{% for js in js_list %}
    {% include 'core/includes/js/'|add:js|add:'.htm' %}
{% endfor %}

    <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.6.3/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.6.3/js/buttons.flash.min.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.6.3/js/buttons.html5.min.js"></script>
    <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.6.3/js/buttons.print.min.js"></script>

<script>
    jQuery(document).ready(function() {
        jQuery('#tblusuarios').DataTable({       
            "order": [[ 1, "desc" ]],
            "pageLength":  10, 
            dom: 'Bfrtip',
            buttons: [
            {
                extend: 'excelHtml5',
                title: 'Rondines'
            },
            {
                extend: 'pdfHtml5',
                title: 'Rondines'
            }],    
           "langrondinese": {
                "url": "//cdn.datatables.net/plug-ins/1.10.20/i18n/Spanish.json"
           }
        });
    });
</script>

<script>
        // Gráfica de Estado General
        var options = {
            colors : ['#333', '#9D292A'],
            series: [{
            name: 'Estado General',
            data: [86]
          }, {
            name: 'Nivel de Vulnerabilidad',
            data: [14]
        }],
            chart: {
            type: 'bar',
            height: 335,
            stacked: true,
            toolbar: {
              show: true
            },
            zoom: {
              enabled: true
            }
          },
          legend: {
            show: false
          },
          yaxis: {
            labels: {
              formatter: function (value) {
                return value + "%";
              }
            },
          },          
          responsive: [{
            breakpoint: 480,            
        }],
          plotOptions: {
            bar: {
              horizontal: false,
            },
          },
          xaxis: {
            type: 'text',
            categories: ['Rondines Completados'],
            labels: {
                style: {
                    fontSize: '16px',
                    fontWeight: 'bold'               
                },
            }
          },
          fill: {
            opacity: 0.90
          },
          dataLabels: {
            style: {
              fontSize: '20px',
              fontWeight: 'bold',
              textShadow: '0 1px #333'
            },
            formatter: function(val, opt) {
                return val + " %    "
            },
          }
          };
  
          //var chart = new ApexCharts(document.querySelector("#graf_rondines_general"), options);
          //chart.render();

          // Fin de gráfica General
    
</script>

<script>
    var options = {
        series: [{
        name: 'No. Rondines',
        type: 'column',
        data: [440, 505, 414, 671, 227, 413, 201, 352, 752, 320, 257, 160]
      }, {
        name: 'Activos (en progreso)',
        type: 'line',
        data: [23, 42, 35, 27, 43, 22, 17, 31, 22, 22, 12, 16]
      }],
        chart: {
        height: 336,
        type: 'line',
      },
      stroke: {
        width: [0, 4]
      },
      title: {
        text: 'Rondines Realizados'
      },
      dataLabels: {
        enabled: true,
        enabledOnSeries: [1]
      },
      labels: ['01 Apr 2020', '02 Apr 2020', '03 Apr 2020', '04 Apr 2020', '05 Apr 2020', '06 Apr 2020', '07 Apr 2020', '08 Apr 2020', '09 Apr 2020', '10 Apr 2020', '11 Apr 2020', '12 Apr 2020'],
      xaxis: {
        type: 'datetime'
      },
      yaxis: [{
        title: {
          text: 'Activos (en progreso)',
        },
      
      }, {
        opposite: true,
        title: {
          text: 'Rondines Realizados'
        }
      }]
      };

      var chart = new ApexCharts(document.querySelector("#graf_rondines_general"), options);
      chart.render();
</script>
<!-- Ends to include JS list -->
{% endblock js %}