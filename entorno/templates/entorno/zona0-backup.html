{% extends 'core/bases/base_pages.html' %}

{% block 'seo_header' %}
    <title>Panoptic | {{ userdict.page_name | upper }} - {{ userdic.tipousuario | upper }}</title>
    <meta http-equiv="Content-Language" content="es-MX">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
    <meta name="description" content="Monitoreo Inteligente en seguridad privada para empresas y unidades de negocio">
{% endblock %}

{% block css %}
    <!-- Starts to include CSS list -->
    {% for css in css_list %}
        {% include 'core/includes/css/'|add:css|add:'.htm' %}
    {% endfor %}
    <!-- Ends to include CSS list -->
{% endblock css %}

{% block 'content' %}
<div class="app-page-title">
    {% load static %}
    <div class="page-title-wrapper">
        <div class="page-title-heading">
            <div class="mini-logo-panoptic">
                <img src="{% static 'core/assets/images/mini-logo-panoptic.png' %}" alt="Logo de Panoptic">                                    
            </div>
            <div>Panel de Control <button class="mb-2 mr-2 btn btn-light tipousuario">{{ userdict.tipousuario }}<span class="badge badge-success badge-dot badge-dot-lg"> </span></button>
                <div class="page-title-subheading">
                    Los siguientes módulos están a su disposición; puede utilizar el menú izquierdo para cualquier opción en particular.
                </div>
            </div>
        </div>
        <!-- Botones laterales del cuerpo -->
        <div class="page-title-actions">                                
            <div class="d-inline-block dropdown">
                <button type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn-shadow dropdown-toggle btn btn-info">
                    <span class="btn-icon-wrapper pr-2 opacity-7">
                        <i class="fa fa-business-time fa-w-20"></i>
                    </span>
                    Acción / Opción a realizar
                </button>
                <div tabindex="-1" role="menu" aria-hidden="true" class="dropdown-menu dropdown-menu-right">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link">
                                <i class="nav-link-icon lnr-inbox"></i>
                                <span>
                                    Mensajes
                                </span>
                                <div class="ml-auto badge badge-pill badge-secondary">86</div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link">
                                <i class="nav-link-icon lnr-book"></i>
                                <span>
                                    Incidentes
                                </span>
                                <div class="ml-auto badge badge-pill badge-danger">5</div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link">
                                <i class="nav-link-icon lnr-picture"></i>
                                <span>
                                    Evidencias
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a disabled="" class="nav-link disabled">
                                <i class="nav-link-icon lnr-file-empty"></i>
                                <span>
                                    Bitácora
                                </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="d-inline-block pr-3">
                <select id="custom-inp-top" type="select" class="custom-select">
                    <option>Periodo...</option>
                    <option>Últimos 3 meses</option>
                    <option>En el último mes</option>                                        
                    <option selected>En los últimos 7 días</option>
                    <option>Últimas 24 hrs.</option>
                </select>
            </div>
        </div>                             
    </div>
</div>                                

<div class="tabs-animation">

    <div class="row">
        <div class="col-md-12 col-xl-12">
        <h4 class="text-uppercase text-left" style="background: #f2f2f2;margin: 0;padding: 5px;"><b>Casa Habitación <i class="fa fa-fw"></i></b></h4>
        </div>
        <div class="col-md-6 col-xl-3">
            <div class="card mb-4 widget-content bgp-white">
                <div class="widget-content-wrapper text-dark">
                    <div class="wrap-indicador">
                        <div class="indicador bgp-color-azul">
                            <!--i class="fas fa-bell"></i-->
                            <img width="42" class="rounded-circle icod-bw" src="/static/core/assets/images/icons/top-marker-blue.png" alt="">
                        </div>                                                
                    </div>
                    <div class="widget-content-left">                                                                                    
                        <div class="widget-heading">Japón</div>
                        <!--div class="widget-subheading darker969696">En el último mes</div-->
                    </div>
                    <div class="widget-content-right">
                        <div class="widget-numbers text-dark"><span>0</span></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-xl-3">
            <div class="card mb-4 widget-content bgp-white">
                <div class="widget-content-wrapper text-dark">
                    <div class="wrap-indicador">
                            <div class="indicador bgp-color-amarillo">
                                <!--i class="fas fa-industry"></i-->
                                <img width="42" class="rounded-circle icod-bw" src="/static/core/assets/images/icons/top-marker-yellow.png" alt="">
                            </div>                                                
                    </div>
                    <div class="widget-content-left">                                                                                    
                        <div class="widget-heading">Asia</div>
                        <!--div class="widget-subheading darker969696">En el último mes</div-->
                    </div>    
                    <div class="widget-content-right">
                        <div class="widget-numbers text-dark"><span>7</span></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-xl-3">
            <div class="card mb-4 widget-content bgp-white">
                <div class="widget-content-wrapper text-dark">
                    <div class="wrap-indicador bgp-color-naranja">
                            <div class="indicador">
                                <!--i class="fas fa-fingerprint"></i-->
                                <img width="42" class="rounded-circle icod-bw" src="/static/core/assets/images/icons/top-marker-orange.png" alt="">
                            </div>                                                
                    </div>
                    <div class="widget-content-left">                                                                                    
                        <div class="widget-heading">Norte, Central y Sur de América</div>
                        <!--div class="widget-subheading darker969696">En el último mes</div-->
                    </div>
                    <div class="widget-content-right">
                        <div class="widget-numbers text-dark"><span>6</span></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-xl-3">
            <div class="card mb-4 widget-content bgp-white">
                <div class="widget-content-wrapper text-dark">
                    <div class="wrap-indicador bgp-color-rojo">
                            <div class="indicador">
                                <!--i class="fas fa-bell"></i-->
                                <img width="42" class="rounded-circle icod-bw" src="/static/core/assets/images/icons/top-marker-red.png" alt="">
                            </div>                                                
                    </div>
                    <div class="widget-content-left">                                                                                    
                        <div class="widget-heading">Europra y Africa</div>
                        <!--div class="widget-subheading darker969696">En el último mes</div-->
                    </div>
                    <div class="widget-content-right">
                        <div class="widget-numbers text-dark"><span>4</span></div>
                    </div>
                </div>
            </div>
        </div>                            
    </div>

    <div class="row">
        <div class="col-sm-12 col-md-12 col-xl-12">
            <div class="card-shadow-primary card-border mb-3 profile-responsive card">
                <div class="dropdown-menu-header">
                    <div class="dropdown-menu-header-inner bgp-azul">                        
                        <div id="zonaHeader" style="position: relative; margin: 0 auto; text-align: center;">
                            <div class="avatar-icon-wrapper mr-3 avatar-icon-xl btn-hover-shine" style="position: relative; padding-left: 10px; display: inline-block;">
                                <i class="fa fa-users size48 en-linea ico-sombra" aria-hidden="true"></i>&nbsp;&nbsp;
                                <div class="widget-panel-texto diamante-bold mayus septxt-2 en-linea">Zona 0</div>                                           
                            </div>                             
                        </div>                                             
                    </div>                
                </div>
                <ul class="list-group list-group-flush">                    
                    <li class="p-0 list-group-item li-sin-borde">
                        <div class="grid-menu grid-menu-2col">
                            <div class="no-gutters row">
                                <div class="col-sm-12">
                                    <div id='map' style='width: auto; height: 662px;'></div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>       
    </div>

    <div id="plotyunit" class="row">
        <div class="col-md-12">            
            {% load plotly_dash %}
            <div class="{% plotly_class name='dash_zona0' %} embed-responsive " style="height: auto; width: 100%">
            {% plotly_app name='dash_zona0' ratio=1.5 %}
            </div>
        </div>
    </div>

</div>                    
{% endblock %}

{% block js %}
<!-- Starts to include JS list -->
{% for js in js_list %}
    {% include 'core/includes/js/'|add:js|add:'.htm' %}
{% endfor %}
<!-- Ends to include JS list -->




<script>    

    var map, heatmap, infowindow;
    var markers = [];

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 3,
            center: {lat: 30.1523153, lng: -106.8905766},
            mapTypeId: 'satellite'
        });

        infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            infoWindow.setPosition(pos);
            infoWindow.setContent('Location found.');
            infoWindow.open(map);
            map.setCenter(pos);            
          }, function() {
            
          });
        } else {
          // Browser doesn't support Geolocation
          
        }
        
        var markers = setMarkers(map);

        heatmap = new google.maps.visualization.HeatmapLayer({
            data: getPoints(),
            map: map
        });       
    }    

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                                'Error: The Geolocation service failed.' :
                                'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
    }

    function toggleHeatmap() {
        heatmap.setMap(heatmap.getMap() ? null : map);
    }     

    function changeRadius() {
        heatmap.set('radius', heatmap.get('radius') ? null : 20);        
    }

    function changeOpacity() {
        heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
    }

    function changeMarkers() {        
        toggleMarkers(markers);
    }

    function toggleMarkers(markers) {
        // Loop through all markers and hide each of them
        for (var i = 0; i < markers.length; i++) {
            var marker = markers[i];
            marker.visible ? marker.setVisible(false) : marker.setVisible(true);
            //marker.setVisible(false);
        }        
    }   

      // Heatmap data: 500 Points
    function getPoints() {
        return [
            {% for o in incidentes %}
            new google.maps.LatLng({{ o.lat}}, {{ o.lng }}),                
            {% endfor %}                    
        ];
    }

    function smoothZoom (map, level, cnt, mode) {
		//alert('Count: ' + cnt + 'and Max: ' + level);

		// If mode is zoom in
		if(mode == true) {

			if (cnt >= level) {
				return;
			}
			else {
				var z = google.maps.event.addListener(map, 'zoom_changed', function(event){
					google.maps.event.removeListener(z);
					smoothZoom(map, level, cnt + 1, true);
				});
				setTimeout(function(){map.setZoom(cnt)}, 50);
			}
		} else {
			if (cnt <= level) {
				return;
			}
			else {
				var z = google.maps.event.addListener(map, 'zoom_changed', function(event) {
					google.maps.event.removeListener(z);
					smoothZoom(map, level, cnt - 1, false);
				});
				setTimeout(function(){map.setZoom(cnt)}, 50);
			}
		}
    }

    function goUbicacion(lugar) {
        var vLugar = 'Ubicación seleccionada';
        var vzoom = 0;
        var latitude  = 0;
        var longitude = 0;
        var whereMarker = null;

        if (lugar == 'usa_east') {
            latitude  =  36.5522;
            longitude =  -83.9171817;
            vLugar = 'Estados Unidos Este';
            vzoom = 6;            
        }  else if (lugar == 'global') {
            latitude  =  24.6110255;
            longitude = -42.8441299;
            vLugar = 'Vista Global';
            vzoom = 2.75;
        } else if (lugar == 'la') {
            latitude  =  15.2985681;
            longitude =  -78.6551153;
            vLugar = 'América Latina';
            vzoom = 4;
        } else if (lugar == 'juarez') {
            latitude  =  31.6874405;
            longitude =  -106.4300477;
            vLugar = 'Ciudad Juárez';
            vzoom = 12;
        } else if (lugar == 'benitojuarez') {
            latitude  = 30.1523153;
            longitude = -106.8905766;
            vLugar = 'Benito Juárez';
            vzoom = 12;
        } else if (lugar == 'europa') {
            latitude  =   52.0930382;
            longitude =  11.3800946;
            vLugar = 'Europa';
            vzoom = 5;
        } else if (lugar == 'asia') {
            latitude  =  33.2888155;
            longitude =  113.5219767;
            vLugar = 'Asia';
            vzoom = 4;
        } else if (lugar == 'oceania') {
            latitude  =  -30.7058591;
            longitude =  143.8021268;
            vLugar = 'Oceanía';
            vzoom = 5;
        }         

        whereMarker = new google.maps.Marker({
            zoom: vzoom,
            position: new google.maps.LatLng(latitude, longitude),
            title: vLugar,
            icon: "{% static 'core/assets/images/where-ico-marker.png' %}",
            map: map,
        });
        map.panTo(whereMarker.getPosition());
        //smoothZoom(map, vzoom, map.getZoom(), true);
        map.setZoom(vzoom);
    }

    function setMarkers(map) {
        // Adds markers to the map.
        
        // Shapes define the clickable region of the icon. The type defines an HTML
        // <area> element 'poly' which traces out a polygon as a series of X,Y points.
        // The final coordinate closes the poly by connecting to the first coordinate.
        var shape = {
            coords: [1, 1, 1, 47, 30, 47, 30, 1],
            type: 'poly'
        };

        var iconos = { 
            'homicidio'         : { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/homicidio.png' %}" },
            'carjacking'        : { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/carjacking.png' %}" },
            'asalto_transeuntes': { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/transeuntes.png' %}" },
            'casa_habitacion'   : { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/casa-habitacion.png' %}" },
            'hotel'             : { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/hotel.png' %}" },
            'aeropuerto'        : { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/aeropuerto.png' %}" },
            'autopartes'        : { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/auto-partes.png' %}" },
            'secuestro'         : { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/secuestro.png' %}" },            
            'lesiones'          : { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/lesiones.png' %}" },            
            'robo_vehiculo'     : { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/carjacking.png' %}" },            
            'narcomenudeo'      : { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/narcomenudeo.png' %}" },            
            'violencia_familiar': { 'img': "{% static 'core/assets/images/icons/delincuenciales-color/secuestro.png' %}" },            
        };            

        var czindex = 500;           

        {% for p in incidentes %}

            var title = '{{ p.tipo }}';
            
            if (title == 'asalto_transeuntes') {
                title = 'Asalto a Transeuntes';
            }   

            var marker = new google.maps.Marker({
                position: {lat: {{ p.lat}}, lng: {{ p.lng }} },
                map: map,
                icon: iconos.{{ p.tipo }}.img,
                shape: shape,
                title: title.toUpperCase(),
                zIndex: czindex
            });    

            marker.infowindow = new google.maps.InfoWindow({
                content: '<h3 class="infoh3"><b>' + '{{ p.desc }}</h3><hr/><h6><span class="infoh6">TIPO:</span><span class="spantipo">' + title.toUpperCase() + '</span><hr/></h6><p class="infop">{{ p.direccion }}, {{ p.ciudad }}, {{ p.estado }}, {{ p.pais }} | Fecha: {{ p.fecha }} | Fuente: Diario MX</p><a href="#" data-id="{{ p.id }}" class="hoverme mb-1 mr-1 btn btn-default">Ver Incidente Relacionado</a>'
            });
            
            marker.addListener('click', function() {
                this.infowindow.open(map, this);
            });           

            markers.push(marker);           
            ++czindex;
            //console.log (title);
        {% endfor %}  

        var ico_plantas = {             
            'optimo': { 'img': "{% static 'core/assets/images/yazaki/yazaki-marker.png' %}" },
            'relevante': { 'img': "{% static 'core/assets/images/alert-icon-plant.gif' %}" },
        }; 

        // Visualización de plantas de cliente

        var czindex = 900, vplantStatus;   

        var pnombre = 'Yazaki Benito Juarez'; 
            
        vplantStatus = 'relevante';

        console.log(vplantStatus);

        var marker = new google.maps.Marker({
            position: {lat: 30.1906773, lng: -106.7928537 },
            map: map,
            icon: ico_plantas.relevante.img,
            shape: shape,
            title: pnombre.toUpperCase(),
            zIndex: czindex
        });

        var estado_planta = '<span class="bgp-color-verde">Óptimo</span>';

        if (vplantStatus == 'relevante') {
            estado_planta = '<span class="bgp-color-rojo">Relevante</span>';



            var plantaAlias = "benitojuarez";

            console.log (plantaAlias);

            jQuery('#addCritical').append('<li class="nav-item"><a class="nav-link" onclick="goUbicacion(\'' + plantaAlias.toLowerCase() + '\')"><i class="nav-link-icon lnr-inbox"></i><span class="nombrePlantaCritica"> Yazaki Benito Juarez</span></a></li>');
        }         

        marker.infowindow = new google.maps.InfoWindow({
            content: '<div class="popupCustom"><div class="buHeader"></div><div class="infoUBH5_Wrapper" onclick="location.href=\'ceo_master\'"><img src="/static/core/assets/images/yazaki/yazaki-marker.png"/><h5 class="infoUBH5">' + pnombre.toUpperCase() + '</h5><span class="small">Álvaro Obregón, Sin Nombre, 31884, Benito Juárez, Chihuahua, México </span></div> <br> <div class="row infoContent"><div class="col-md-6"><p><b>Nivel de Seguridad:</b>' + estado_planta + '</p><p><b>Incidentes logísticos</b></p><hr/><p><b>PREDICTIVE ANALYTICS</b><br/>COBERTURA<br/><img src="/static/core/assets/images/indicador.jpg"/></p></div><div class="col-md-6"><div class="map_scroll_wrapper"><div class="map_scroll_content"> <p><b>Seguridad Electrónica</b>: 84.17%</p><p>Falla eléctrica total en planta G3783-Yak5 por explosión de estación de gasolina.</p><p>La planta Yazaki Benito Juarez quedó en un 75% afectada por razones de tormentas eléctricas y vientos fuertes en la ciudad, debido a que se dio una alerta roja desde el gobierno mexicano.<br/>Se tiene un estimado de varias horas antes de que la tormenta y los vientos fuertes se retiren.</p></div></div></div></div></div>',
            maxWidth: 550
        });           
        
        marker.addListener('click', function() {
            this.infowindow.open(map, this);
        });

        google.maps.event.trigger(marker,'click');

        console.log(marker);           
            
        return markers;
    }   

    jQuery( document ).ready(function() {
        jQuery('.hoverme').mouseenter(function(){
            jQuery('#lista_incidentes').hide();
        }); 
        jQuery('.hoverme').mouseleave(function(){
            jQuery('#lista_incidentes').show();
        });       
    });
    
  </script>

  <script>
    var pathnameInDashboardHome = window.location.pathname;
    console.log ( pathnameInDashboardHome );
    if (pathnameInDashboardHome == '/ceo_master/yazaki_benito_juarez') {
        
        // Generación de objeto MapBox

        mapboxgl.accessToken = 'pk.eyJ1IjoiamVzdXNjYW1hcmlsbG8iLCJhIjoiY2szcm1lOXg1MDAwZjNnbGtibjMwN2xxeSJ9.a-4Xcq8tojNuH5Ci6pqHYQ';
          
        var jsonDataGeo = '{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"dbh":99},"geometry":{"type":"Point","coordinates":[-106.3973228,31.6680723]}},{"type":"Feature","properties":{"dbh":119},"geometry":{"type":"Point","coordinates":[-106.3990667,31.6695727]}},{"type":"Feature","properties":{"dbh":99},"geometry":{"type":"Point","coordinates":[-106.4008102,31.6694498]}},{"type":"Feature","properties":{"dbh":79},"geometry":{"type":"Point","coordinates":[-106.4096167,31.6839375]}},{"type":"Feature","properties":{"dbh":39},"geometry":{"type":"Point","coordinates":[-106.4071047,31.6882471]}}]}';

        var jsonDataGeo2 = '{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"dbh":99},"geometry":{"type":"Point","coordinates":[-106.3273228,31.6680723]}},{"type":"Feature","properties":{"dbh":119},"geometry":{"type":"Point","coordinates":[-106.3290667,31.6695727]}},{"type":"Feature","properties":{"dbh":99},"geometry":{"type":"Point","coordinates":[-106.3808102,31.6694498]}},{"type":"Feature","properties":{"dbh":79},"geometry":{"type":"Point","coordinates":[-106.3796167,31.6839375]}},{"type":"Feature","properties":{"dbh":39},"geometry":{"type":"Point","coordinates":[-106.3871047,31.6882471]}}]}';
            
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/jesuscamarillo/ck689p7e514961impenkqakyx',
            center: [-96.1898535, 26.1031168],
            zoom: 1.75
        });

            map.on('load', function() {

                map.loadImage(
                        '',
                        function(error, image) {
                            if (error) throw error;
                            map.addImage('cat', image);
                            map.addLayer({
                                'id': 'points',
                                'type': 'symbol',
                                'source': {
                                'type': 'geojson',
                                'data': {
                                'type': 'FeatureCollection',
                                'features': [
                                    {
                                        'type': 'Feature',
                                        'geometry': {
                                            'type': 'Point',
                                            'coordinates': [-106.3990667,31.6695727]
                                        }
                                    }
                                ]
                            }
                        },
                        'layout': {
                            'icon-image': 'cat',
                            'icon-size': 0.1
                            }
                        });
                    }
                );

                map.addSource('trees', {
                    "type": "geojson",
                    "buffer": 1,
                    "data":  JSON.parse(jsonDataGeo)
                });           

                map.addSource('trees2', {
                    "type": "geojson",
                    "buffer": 2,
                    "data":  JSON.parse(jsonDataGeo2)
                });           

                map.addLayer({
                    "id": "trees-heat",
                    "type": "heatmap",
                    "source": "trees",
                    "maxzoom": 18,
                    "paint": {
                    // increase weight as diameter breast height increases
                        "heatmap-weight": {
                            "property": "dbh",
                            "type": "exponential",
                            "stops": [
                                [1, 0],
                                [62, 1]
                            ]
                        },
                    // increase intensity as zoom level increases
                        "heatmap-intensity": {
                            "stops": [
                                [11, 1],
                                [15, 3]
                            ]
                        },
                    // use sequential color palette to use exponentially as the weight increases
                        "heatmap-color": [
                            "interpolate",
                            ["linear"],
                            ["heatmap-density"],
                            0, "rgba(255,255,255,0.1)",
                            0.2, "red",
                            0.4, "orange",
                            0.6, "yellow",
                            0.8, "green"
                        ],
                        // increase radius as zoom increases
                        "heatmap-radius": {
                            "stops": [
                                [14, 19],
                                [19, 26]
                            ]
                        },
                        // decrease opacity to transition into the circle layer
                        "heatmap-opacity": {
                            "default": 1,
                            "stops": [
                                [14, 1],
                                [15, 0]
                            ]
                        },
                    }
                }, 'waterway-label');

                map.addLayer({
                    "id": "trees-heat2",
                    "type": "heatmap",
                    "source": "trees2",
                    "maxzoom": 18,
                    "paint": {
                    // increase weight as diameter breast height increases
                        "heatmap-weight": {
                            "property": "dbh",
                            "type": "exponential",
                            "stops": [
                                [1, 0],
                                [62, 1]
                            ]
                        },
                    // increase intensity as zoom level increases
                        "heatmap-intensity": {
                            "stops": [
                                [11, 1],
                                [15, 3]
                            ]
                        },
                    // use sequential color palette to use exponentially as the weight increases
                        "heatmap-color": [
                            "interpolate",
                            ["linear"],
                            ["heatmap-density"],
                            0, "rgba(255,255,255,0.1)",
                            0.2, "purple",
                            0.4, "brown",
                            0.6, "pink",
                            0.8, "cyan"
                        ],
                        // increase radius as zoom increases
                        "heatmap-radius": {
                            "stops": [
                                [14, 19],
                                [19, 26]
                            ]
                        },
                        // decrease opacity to transition into the circle layer
                        "heatmap-opacity": {
                            "default": 1,
                            "stops": [
                                [14, 1],
                                [15, 0]
                            ]
                        },
                    }
                }, 'waterway-label');            
        });

        // Gráfica de Estado General
        var options = {
            colors : ['#333', '#9D292A'],
            series: [{
            name: 'Estado General',
            data: [82.04]
          }, {
            name: 'Nivel de Vulnerabilidad',
            data: [17.96]
          }],
            chart: {
            type: 'bar',
            height: 620,
            stacked: true,
            toolbar: {
              show: true
            },
            zoom: {
              enabled: true
            }
          },
          legend: {
            show: false
          },
          yaxis: {
            labels: {
              formatter: function (value) {
                return value + "%";
              }
            },
          },          
          responsive: [{
            breakpoint: 480,            
          }],
          plotOptions: {
            bar: {
              horizontal: false,
            },
          },
          xaxis: {
            type: 'text',
            categories: ['Estado General'],
            labels: {
                style: {
                    fontSize: '16px',
                    fontWeight: 'bold'               
                },
            }
          },
          fill: {
            opacity: 0.90
          },
          dataLabels: {
            style: {
              fontSize: '20px',
              fontWeight: 'bold',
              textShadow: '0 1px #333'
            },
            formatter: function(val, opt) {
                return val + " %    "
            },
          }
          };
  
          var chart = new ApexCharts(document.querySelector("#ceo_master_graf_general"), options);
          chart.render();

          // Fin de gráfica General
    }

    //jQuery('.django-plotly-dash-iframe').css('height', '920px');
</script>

    
  <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNIX6WrjQ6HgnfcI50Xb8ezhohFDeOE8s&libraries=visualization&callback=initMap">
  </script>

{% endblock js %}
